(()=>{function A(){if("ancestorOrigins"in location){let t=location.ancestorOrigins,n=t[1]??t[0];if(n)return n.split("/")[2]}let e=document.referrer;return e?e.split("/")[2]:location.origin}var b=chrome;var ce="https://api.nopecha.com";var l="https://www.nopecha.com",F="https://developers.nopecha.com",de="https://nopecha.com/api-reference/",De={doc:{url:F,automation:{url:`${F}/guides/extension_advanced/#automation-build`}},ref:{url:de},api:{base:ce,recognition:"/v1/recognition",status:"/v1/status"},www:{url:l,annoucement:{url:`${l}/json/announcement.json`},demo:{url:`${l}/captcha`,hcaptcha:{url:`${l}/captcha/hcaptcha`},recaptcha:{url:`${l}/captcha/recaptcha`},funcaptcha:{url:`${l}/captcha/funcaptcha`},awscaptcha:{url:`${l}/captcha/awscaptcha`},textcaptcha:{url:`${l}/captcha/textcaptcha`},turnstile:{url:`${l}/captcha/turnstile`},perimeterx:{url:`${l}/captcha/perimeterx`},geetest:{url:`${l}/captcha/geetest`},lemincaptcha:{url:`${l}/captcha/lemincaptcha`}},manage:{url:`${l}/manage`},pricing:{url:`${l}/pricing`},setup:{url:`${l}/setup`}},discord:{url:`${l}/discord`},github:{url:`${l}/github`,release:{url:`${l}/github/release`}}};function q(e){let t=("4bba7932fc09d4cce09e1aba0037cb66b9c0d39d70f4cb482262ba1f523717a7"+e).split("").map(n=>n.charCodeAt(0));return N(t)}var O=new Uint32Array(256);for(let e=256;e--;){let t=e;for(let n=8;n--;)t=t&1?3988292384^t>>>1:t>>>1;O[e]=t}function N(e){let t=-1;for(let n of e)t=t>>>8^O[t&255^n];return(t^-1)>>>0}async function c(e,t){let n=""+[+new Date,performance.now(),Math.random()],[o,a]=await new Promise(i=>{b.runtime.sendMessage([n,e,...t],r=>{i(r)})});if(o===q(n))return a}function y(){let e;return t=>e||(e=t().finally(()=>e=void 0),e)}var f,me=y();function U(){return me(async()=>(f||(f=await c("settings::get",[])),f))}function G(e){f&&(f={...f,...e},z(f))}function T(){return f}function m(e){return new Promise(t=>setTimeout(t,e))}var W=[];function x(e,t){e.timedout=!1,W.push(e);let n,o=setInterval(async()=>{await J(e,T())||(clearTimeout(n),clearInterval(o))},400);t&&(n=setTimeout(()=>clearInterval(o),t),e.timedout=!0)}async function J(e,t){if(e.timedout)return!1;let n=e.condition(t);if(n===e.running())return!1;if(!n&&e.running())return e.quit(),!1;if(n&&!e.running()){for(;!e.ready();)await m(200);return e.start(),!1}}function z(e){W.forEach(t=>J(t,e))}function V(){b.runtime.connect({name:"stream"}).onMessage.addListener(t=>{t.event==="settingsUpdate"&&G(t.settings)})}function k(e){if(document.readyState!=="loading")setTimeout(e,0);else{let t;t=()=>{removeEventListener("DOMContentLoaded",t),e()},addEventListener("DOMContentLoaded",t)}}var tt=y();function ge(){return!0}async function pe(e){e.scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"}),await new Promise(t=>requestAnimationFrame(t))}function Q(){let e=`verify_${Math.random().toString(36).slice(2)}`;return document.documentElement.setAttribute("data-frame-token",e),e}function K(){document.documentElement.removeAttribute("data-frame-token")}var _=null,j=null;async function fe(){if(_!==null)return _;clearTimeout(j),j=setTimeout(()=>{_=null},6e4),_=!1,await c("debugger::enable",[]);let e=Q();try{await c("debugger::mouseCapable",[e])===!0&&(_=!0)}catch{}finally{K()}return _}async function M(e,t,n,o,a,i){await c("debugger::enable",[]);let r=Q();try{if(await c("debugger::mouse",[r,e,t,n,o,a,i])===!0)return!0}catch{}finally{K()}return!1}async function E(e,t,n,o,a,i,r){await c("debugger::enable",[]),await pe(e);let u=e.getBoundingClientRect();if(u.width===0||u.height===0)return!1;n=n??null,o=o??null;let s=n!==null?u.left+n:u.left+u.width/2,d=o!==null?u.top+o:u.top+u.height/2,g=4;if(n===null){let p=Math.floor((Math.random()-.5)*.5*Math.max(u.width-g*2,0));s+=p}if(o===null){let p=Math.floor((Math.random()-.5)*.5*Math.max(u.height-g*2,0));d+=p}return await M(t,s,d,a,i,r)}async function he(e,t,n,o,a,i){if(["focus","blur","click","pointerdown","pointerup","pointermove","pointerrawupdate","pointerover","pointerenter","mouseenter","mouseover","pointerout","pointerleave","mouseout","mouseleave"].includes(t))return!0;a=a??0;let s=["none","left","middle","right"][a]??"none";return t==="mousedown"?e===null?await M("mousePressed",n,o,s,1,i):await E(e,"mousePressed",n,o,s,1,i):t==="mouseup"?(s=s==="none"?"left":s,e===null?await M("mouseReleased",n,o,s,1,i):await E(e,"mouseReleased",n,o,s,1,i)):t==="mousemove"?e===null?await M("mouseMoved",n,o,s,0,i):await E(e,"mouseMoved",n,o,s,0,i):!1}function be(e,t,n,o,a){e===null&&(e=document.body),a=a??0,["pointerup","mouseup"].includes(t)&&a!==0&&(a=0);let i=null;if(t==="focus"){let r={bubbles:!1,cancelable:!1,view:window};i=new FocusEvent(t,r)}else if(t==="blur"){let r={bubbles:!1,cancelable:!1,view:window};i=new FocusEvent(t,r)}else if(t==="click"){let r={bubbles:!0,cancelable:!0,view:window,buttons:0,clientX:Math.floor(n),clientY:Math.floor(o),pointerId:1,pointerType:"mouse"};i=new PointerEvent(t,r)}else if(t.startsWith("mouse")){let r={bubbles:!0,cancelable:!0,view:window,buttons:a,clientX:Math.floor(n),clientY:Math.floor(o)};i=new MouseEvent(t,r)}else if(t.startsWith("pointer")){t==="pointerrawupdate"&&(n+=87.857,o+=10.571);let r={bubbles:!0,cancelable:!0,view:window,buttons:a,clientX:n+.2857360839844,clientY:o+.42857360839844,pointerId:1,pointerType:"mouse"};i=new PointerEvent(t,r)}else return!1;try{return e.dispatchEvent(i),!0}catch{return!1}}function _e(e){let t=typeof e=="string"?document.querySelector(e):e;return t||null}async function ve(){return!!(ge()&&await fe()===!0)}async function we(e,t,n,o,a,i,r){return r=r??await ve(),!!(r&&await he(e,t,n,o,a,i)||be(e,t,n,o,a)===!0)}async function h(e,t,n){t=t??null,n=n??null;let o=t,a=n,i=null;if(e===null){if(t===null||n===null)return!1}else{if(i=_e(e),i===null)return!1;let s=i.getBoundingClientRect();o=t??s.width/2,a=n??s.height/2;let d=4;if(t===null){let g=Math.floor((Math.random()-.5)*.5*Math.max(s.width-d*2,0));o+=g}if(n===null){let g=Math.floor((Math.random()-.5)*.5*Math.max(s.height-d*2,0));a+=g}}let r=[{name:"pointerrawupdate",buttons:0,delayMs:0},{name:"pointerover",buttons:0,delayMs:0},{name:"pointerenter",buttons:0,delayMs:0},{name:"mouseover",buttons:0,delayMs:0},{name:"mouseenter",buttons:0,delayMs:10},{name:"pointermove",buttons:0,delayMs:0},{name:"mousemove",buttons:0,delayMs:10},{name:"pointerrawupdate",buttons:0,delayMs:0},{name:"pointermove",buttons:0,delayMs:0},{name:"mousemove",buttons:0,delayMs:30},{name:"focus",buttons:0,delayMs:0},{name:"pointerdown",buttons:1,delayMs:0},{name:"mousedown",buttons:1,delayMs:30},{name:"pointerup",buttons:0,delayMs:0},{name:"mouseup",buttons:0,delayMs:0},{name:"click",buttons:0,delayMs:0}],u=[];for(let{name:s,buttons:d,delayMs:g}of r){let p=await we(i,s,o,a,d);u.push(p),g&&await m(g)}return u.every(s=>s)}var ye=["#home_children_button","#wrong_children_button","#wrongTimeout_children_button","button[data-theme*=verifyButton]","[class*=game-fail] .button",".error .button"],Z=["#root","#app","#home","#wrong","#wrongTimeout",".container[dir]"].join(", "),S,B=!1;function X(){return!!document.querySelector(Z)}function Y(){B=!0;let e=()=>{Te(),document.querySelectorAll(Z).forEach(t=>{S.observe(t,{childList:!0})})};S=new MutationObserver(e),e()}function ee(){S.disconnect(),B=!1}function te(){return B}async function Te(){await m(500);let e=ye.map(t=>document.querySelector(t)).filter(t=>t);for(let t of e)await h(t)}function ne(){return[]}function oe(e,t){return new Promise((n,o)=>{e.push(n),t&&setTimeout(()=>{o(new Error("Signal wait timeout"))},t)})}function v(e){e.forEach(t=>t()),e.splice(0)}async function ae(e,t){let n={v:b.runtime.getManifest().version,key:Me(e)};return n.url=await c("tab::getURL",[]),n}function Me(e){return!e.keys||!e.keys.length?e.key:e.keys[Math.floor(Math.random()*e.keys.length)]}function Ce(e,t){let n=document.createElement("canvas");return n.width=e,n.height=t,n}function P(e){return e.toDataURL("image/jpeg").replace(/data:image\/[a-z]+;base64,/g,"")}function xe(e){try{e.getContext("2d").getImageData(0,0,1,1)}catch{return!0}return!1}async function I(e,t,n=1e4){if(!t&&!e.complete&&!await new Promise(r=>{let u=setTimeout(()=>{r(!1)},n);e.addEventListener("load",()=>{clearTimeout(u),r(!0)})}))return;let o=Ce(e.naturalWidth||t?.clientWidth,e.naturalHeight||t?.clientHeight);return o.getContext("2d").drawImage(e,0,0),!xe(o)&&o}async function R(e){let n=getComputedStyle(e).backgroundImage;if(!n||n==="none")if("src"in e&&e.src)n=`url("${e.src}")`;else return;if("computedStyleMap"in e&&!/url\(["']https?:\/\//.test(n)){let s=e.computedStyleMap().get("background-image");if(s instanceof CSSImageValue){let d=await I(s,e);if(d)return d}}let o=/"(.+)"/.exec(n);if(!o)return;n=o[1];let a=document.createElement("a");if(a.href=n,new URL(a.href).origin===document.location.origin){let s=new Image;s.crossOrigin="anonymous",s.src=n;let d=await I(s);if(d)return d}let i=await c("fetch::asData",[n,{}]),r=new Image;r.crossOrigin="anonymous",r.src=i.data;let u=await I(r);if(u)return u}function ke(e,t,n,o){let a=(o*t+n)*4;return[e[a],e[a+1],e[a+2]]}function Ee(e,t){return e.every(n=>n<=t)}function Se(e,t){return e.every(n=>n>=t)}function H(e,t=0,n=230,o=.99){let a=e.getContext("2d"),i=a.canvas.width,r=a.canvas.height;if(i===0||r===0)return!0;let u=a.getImageData(0,0,i,r).data,s=0;for(let g=0;g<r;g++)for(let p=0;p<i;p++){let $=ke(u,i,p,g);(Ee($,t)||Se($,n))&&s++}return s/(i*r)>o}var w=ne(),D,C=!1;function ie(){return L()!==void 0}function se(){C=!0,v(w),D=new MutationObserver(e=>{let t=L();for(let n of e)if(n.type==="childList"&&n.removedNodes.length&&["app","game"].includes(n.target.id)){setTimeout(()=>v(w),200);return}t==="TileV2"&&e.length===24&&!document.querySelector(".loading-spinner")&&setTimeout(()=>v(w),200),t==="Match"&&[8,13].includes(e.length)&&!document.querySelector(".loading-spinner")&&setTimeout(()=>v(w),200)}),D.observe(document,{childList:!0,subtree:!0,attributes:!0}),Pe()}function ue(){D.disconnect(),C=!1,v(w)}function le(){return C}var Be={["Tile"]:{async getTask(){let e=document.querySelector("#game_children_text h2"),t=document.querySelector("#game_challengeItem_image"),n=[...document.querySelectorAll("#game_children_challenge a")];if(!(!e||!t||n.length!==6))return{payload:{type:"funcaptcha",task:e.textContent,image_data:[t.src.replace(/data:image\/[a-z]+;base64,/g,"")]},cells:n}},async solution(e,t){for(let[n,o]of e.cells.entries())t.data[n]&&await h(o)}},["TileV2"]:{async getTask(){let e=document.querySelector(".tile-game h2"),t=[...document.querySelectorAll(".challenge-container button")];if(!e||t.length!==6)return;let n=await R(t[0]);if(n&&!H(n))return{payload:{type:"funcaptcha",task:e.textContent,image_data:[P(n)]},cells:t}},async solution(e,t){for(let[n,o]of e.cells.entries())t.data[n]&&await h(o)}},["Match"]:{async getTask(){let e=document.querySelector(".match-game h2"),t=document.querySelector(".key-frame-image");if(!e||!t)return;let n=await R(t);if(n&&!H(n))return{payload:{type:"funcaptcha_match",task:e.textContent,image_data:[P(n)]}}},async solution(e,t){let n=document.querySelector(".right-arrow"),o=t.data.indexOf(!0);for(let a=0;a<o;a++)await h(n),await m(100);await m(500),await h(".button")}}},Ie=[["script[src*=tile-game-ui]","Tile"],[".tile-game","TileV2"],[".match-game","Match"]];function L(){return Ie.filter(([e,t])=>document.querySelector(e)).map(([e,t])=>t)[0]}var re=!1;async function Pe(){if(!re)for(re=!0;C;){let e=L();if(e===void 0){await m(500);continue}let t=Be[e],n=await t.getTask();if(!n){await m(500);continue}let o=T(),a=await ae(o,!0),i=Date.now(),r=await c("api::recognition",[{...a,...n.payload}]);if(!r||"error"in r){await m(2e3);continue}let u=Date.now();if(o.funcaptcha_solve_delay){let s=o.funcaptcha_solve_delay_time-u+i;s>0&&await m(s)}await t.solution(n,r);try{await oe(w,1e4),await m(1e3)}catch{}}}async function Re(){V(),await U(),await c("tab::registerDetectedCaptcha",["funcaptcha"]);let e=A();x({name:"funcaptcha/auto-open",condition:t=>t.enabled&&t.funcaptcha_auto_open&&!t.disabled_hosts.includes(e),ready:X,start:Y,quit:ee,running:te}),x({name:"funcaptcha/auto-solve",condition:t=>t.enabled&&t.funcaptcha_auto_solve&&!t.disabled_hosts.includes(e),ready:ie,start:se,quit:ue,running:le})}k(Re);})();
