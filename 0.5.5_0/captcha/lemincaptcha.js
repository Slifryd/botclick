(()=>{var Xe=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var g=(n,e,t)=>(Xe(n,e,"read from private field"),t?t.call(n):e.get(n)),h=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)};var m=(n,e,t)=>(Xe(n,e,"access private method"),t);var X=chrome;var Ht="https://api.nopecha.com";var x="https://www.nopecha.com",Ke="https://developers.nopecha.com",Ft="https://nopecha.com/api-reference/",sn={doc:{url:Ke,automation:{url:`${Ke}/guides/extension_advanced/#automation-build`}},ref:{url:Ft},api:{base:Ht,recognition:"/v1/recognition",status:"/v1/status"},www:{url:x,annoucement:{url:`${x}/json/announcement.json`},demo:{url:`${x}/captcha`,hcaptcha:{url:`${x}/captcha/hcaptcha`},recaptcha:{url:`${x}/captcha/recaptcha`},funcaptcha:{url:`${x}/captcha/funcaptcha`},awscaptcha:{url:`${x}/captcha/awscaptcha`},textcaptcha:{url:`${x}/captcha/textcaptcha`},turnstile:{url:`${x}/captcha/turnstile`},perimeterx:{url:`${x}/captcha/perimeterx`},geetest:{url:`${x}/captcha/geetest`},lemincaptcha:{url:`${x}/captcha/lemincaptcha`}},manage:{url:`${x}/manage`},pricing:{url:`${x}/pricing`},setup:{url:`${x}/setup`}},discord:{url:`${x}/discord`},github:{url:`${x}/github`,release:{url:`${x}/github/release`}}};function Ye(n){let e=("4bba7932fc09d4cce09e1aba0037cb66b9c0d39d70f4cb482262ba1f523717a7"+n).split("").map(t=>t.charCodeAt(0));return Ze(e)}var Qe=new Uint32Array(256);for(let n=256;n--;){let e=n;for(let t=8;t--;)e=e&1?3988292384^e>>>1:e>>>1;Qe[n]=e}function Ze(n){let e=-1;for(let t of n)e=e>>>8^Qe[e&255^t];return(e^-1)>>>0}async function E(n,e){let t=""+[+new Date,performance.now(),Math.random()],[i,o]=await new Promise(a=>{X.runtime.sendMessage([t,n,...e],s=>{a(s)})});if(i===Ye(t))return o}function et(){let n;return e=>n||(n=e().finally(()=>n=void 0),n)}var D,qt=et();function tt(){return qt(async()=>(D||(D=await E("settings::get",[])),D))}function nt(n){D&&(D={...D,...n},ot(D))}function le(){return D}function k(n){return new Promise(e=>setTimeout(e,n))}var at=[];function Ae(n,e){n.timedout=!1,at.push(n);let t,i=setInterval(async()=>{await it(n,le())||(clearTimeout(t),clearInterval(i))},400);e&&(t=setTimeout(()=>clearInterval(i),e),n.timedout=!0)}async function it(n,e){if(n.timedout)return!1;let t=n.condition(e);if(t===n.running())return!1;if(!t&&n.running())return n.quit(),!1;if(t&&!n.running()){for(;!n.ready();)await k(200);return n.start(),!1}}function ot(n){at.forEach(e=>it(e,n))}function rt(){X.runtime.connect({name:"stream"}).onMessage.addListener(e=>{e.event==="settingsUpdate"&&nt(e.settings)})}function De(n){if(document.readyState!=="loading")setTimeout(n,0);else{let e;e=()=>{removeEventListener("DOMContentLoaded",e),n()},addEventListener("DOMContentLoaded",e)}}function Wt(){return!0}async function Gt(n){n.scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"}),await new Promise(e=>requestAnimationFrame(e))}function ct(){let n=`verify_${Math.random().toString(36).slice(2)}`;return document.documentElement.setAttribute("data-frame-token",n),n}function lt(){document.documentElement.removeAttribute("data-frame-token")}var K=null,st=null;async function zt(){if(K!==null)return K;clearTimeout(st),st=setTimeout(()=>{K=null},6e4),K=!1,await E("debugger::enable",[]);let n=ct();try{await E("debugger::mouseCapable",[n])===!0&&(K=!0)}catch{}finally{lt()}return K}async function ue(n,e,t,i,o,a){await E("debugger::enable",[]);let s=ct();try{if(await E("debugger::mouse",[s,n,e,t,i,o,a])===!0)return!0}catch{}finally{lt()}return!1}async function Le(n,e,t,i,o,a,s){await E("debugger::enable",[]),await Gt(n);let r=n.getBoundingClientRect();if(r.width===0||r.height===0)return!1;t=t??null,i=i??null;let c=t!==null?r.left+t:r.left+r.width/2,l=i!==null?r.top+i:r.top+r.height/2,u=4;if(t===null){let d=Math.floor((Math.random()-.5)*.5*Math.max(r.width-u*2,0));c+=d}if(i===null){let d=Math.floor((Math.random()-.5)*.5*Math.max(r.height-u*2,0));l+=d}return await ue(e,c,l,o,a,s)}async function jt(n,e,t,i,o,a){if(["focus","blur","click","pointerdown","pointerup","pointermove","pointerrawupdate","pointerover","pointerenter","mouseenter","mouseover","pointerout","pointerleave","mouseout","mouseleave"].includes(e))return!0;o=o??0;let c=["none","left","middle","right"][o]??"none";return e==="mousedown"?n===null?await ue("mousePressed",t,i,c,1,a):await Le(n,"mousePressed",t,i,c,1,a):e==="mouseup"?(c=c==="none"?"left":c,n===null?await ue("mouseReleased",t,i,c,1,a):await Le(n,"mouseReleased",t,i,c,1,a)):e==="mousemove"?n===null?await ue("mouseMoved",t,i,c,0,a):await Le(n,"mouseMoved",t,i,c,0,a):!1}function Vt(n,e,t,i,o){n===null&&(n=document.body),o=o??0,["pointerup","mouseup"].includes(e)&&o!==0&&(o=0);let a=null;if(e==="focus"){let s={bubbles:!1,cancelable:!1,view:window};a=new FocusEvent(e,s)}else if(e==="blur"){let s={bubbles:!1,cancelable:!1,view:window};a=new FocusEvent(e,s)}else if(e==="click"){let s={bubbles:!0,cancelable:!0,view:window,buttons:0,clientX:Math.floor(t),clientY:Math.floor(i),pointerId:1,pointerType:"mouse"};a=new PointerEvent(e,s)}else if(e.startsWith("mouse")){let s={bubbles:!0,cancelable:!0,view:window,buttons:o,clientX:Math.floor(t),clientY:Math.floor(i)};a=new MouseEvent(e,s)}else if(e.startsWith("pointer")){e==="pointerrawupdate"&&(t+=87.857,i+=10.571);let s={bubbles:!0,cancelable:!0,view:window,buttons:o,clientX:t+.2857360839844,clientY:i+.42857360839844,pointerId:1,pointerType:"mouse"};a=new PointerEvent(e,s)}else return!1;try{return n.dispatchEvent(a),!0}catch{return!1}}function Jt(n){let e=typeof n=="string"?document.querySelector(n):n;return e||null}async function Ut(){return!!(Wt()&&await zt()===!0)}async function Xt(n,e,t,i,o,a,s){return s=s??await Ut(),!!(s&&await jt(n,e,t,i,o,a)||Vt(n,e,t,i,o)===!0)}async function ut(n,e,t){e=e??null,t=t??null;let i=e,o=t,a=null;if(n===null){if(e===null||t===null)return!1}else{if(a=Jt(n),a===null)return!1;let c=a.getBoundingClientRect();i=e??c.width/2,o=t??c.height/2;let l=4;if(e===null){let u=Math.floor((Math.random()-.5)*.5*Math.max(c.width-l*2,0));i+=u}if(t===null){let u=Math.floor((Math.random()-.5)*.5*Math.max(c.height-l*2,0));o+=u}}let s=[{name:"pointerrawupdate",buttons:0,delayMs:0},{name:"pointerover",buttons:0,delayMs:0},{name:"pointerenter",buttons:0,delayMs:0},{name:"mouseover",buttons:0,delayMs:0},{name:"mouseenter",buttons:0,delayMs:10},{name:"pointermove",buttons:0,delayMs:0},{name:"mousemove",buttons:0,delayMs:10},{name:"pointerrawupdate",buttons:0,delayMs:0},{name:"pointermove",buttons:0,delayMs:0},{name:"mousemove",buttons:0,delayMs:30},{name:"focus",buttons:0,delayMs:0},{name:"pointerdown",buttons:1,delayMs:0},{name:"mousedown",buttons:1,delayMs:30},{name:"pointerup",buttons:0,delayMs:0},{name:"mouseup",buttons:0,delayMs:0},{name:"click",buttons:0,delayMs:0}],r=[];for(let{name:c,buttons:l,delayMs:u}of s){let d=await Xt(a,c,i,o,l);r.push(d),u&&await k(u)}return r.every(c=>c)}var Ne,He=!1;function dt(){return!!document.querySelector('input[name="lemin_challenge_id"]')}function mt(){He=!0;let n=()=>{document.querySelector(".lemin-captcha-input-box").classList.contains("pending")||Kt()};Ne=new MutationObserver(n),Ne.observe(document.querySelector(".lemin-captcha-input-box"),{attributes:!0,attributeFilter:["class"]}),n()}function gt(){Ne.disconnect(),He=!1}function pt(){return He}async function Kt(){await k(400),await ut('span[class="checkmark"]')}function de(n,e){let t=document.createElement("canvas");return t.width=n,t.height=e,t}function ft(n){return n.toDataURL("image/jpeg").replace(/data:image\/[a-z]+;base64,/g,"")}function Yt(n){try{n.getContext("2d").getImageData(0,0,1,1)}catch{return!0}return!1}async function Fe(n,e,t=1e4){if(!e&&!n.complete&&!await new Promise(s=>{let r=setTimeout(()=>{s(!1)},t);n.addEventListener("load",()=>{clearTimeout(r),s(!0)})}))return;let i=de(n.naturalWidth||e?.clientWidth,n.naturalHeight||e?.clientHeight);return i.getContext("2d").drawImage(n,0,0),!Yt(i)&&i}async function ht(n){let t=getComputedStyle(n).backgroundImage;if(!t||t==="none")if("src"in n&&n.src)t=`url("${n.src}")`;else return;if("computedStyleMap"in n&&!/url\(["']https?:\/\//.test(t)){let c=n.computedStyleMap().get("background-image");if(c instanceof CSSImageValue){let l=await Fe(c,n);if(l)return l}}let i=/"(.+)"/.exec(t);if(!i)return;t=i[1];let o=document.createElement("a");if(o.href=t,new URL(o.href).origin===document.location.origin){let c=new Image;c.crossOrigin="anonymous",c.src=t;let l=await Fe(c);if(l)return l}let a=await E("fetch::asData",[t,{}]),s=new Image;s.crossOrigin="anonymous",s.src=a.data;let r=await Fe(s);if(r)return r}function bt(n,e="",t=""){let i=n.getContext("2d").getImageData(0,0,n.width,n.height),o=de(n.width,n.height),a=o.getContext("2d");a.putImageData(i,0,0);let s=75,r=75,c=n.width,l=n.height,u=c/l,d=c,p=l;d>s&&(d=s,p=d/u),p>r&&(p=r,d=p*u);function _(y,G,I,z){let P=10,J=z,U,O;if(y.font=`${J}px Arial`,O=y.measureText(G).width,O<=I)return`${J}px Arial`;for(;J-P>.1;)U=(J+P)/2,y.font=`${U}px Arial`,O=y.measureText(G).width,O>I?J=U:P=U;for(;O<I&&P<z;)P+=.1,y.font=`${P.toFixed(1)}px Arial`,O=y.measureText(G).width;return O>I&&(P-=.1),`${P.toFixed(1)}px Arial`}a.font=_(a,t,c,200),a.textBaseline="top";let w=a.measureText(t),f=w.width,S=w.actualBoundingBoxAscent+w.actualBoundingBoxDescent;a.fillStyle="white",a.fillRect(0,0,f,S),a.fillStyle="black",a.fillText(t,0,0);let C=o.toDataURL(),v=new Image;v.onload=function(){let y=[`background: url(${C}) no-repeat;`,`padding: ${p}px ${d}px;`,"background-size: contain;","font-size: 1px;"].join(" ")},v.src=C}function Qt(n,e,t,i){let o=(i*e+t)*4;return[n[o],n[o+1],n[o+2]]}function Zt(n,e){return n.every(t=>t<=e)}function en(n,e){return n.every(t=>t>=e)}function _t(n,e=0,t=230,i=.99){let o=n.getContext("2d"),a=o.canvas.width,s=o.canvas.height;if(a===0||s===0)return!0;let r=o.getImageData(0,0,a,s).data,c=0;for(let u=0;u<s;u++)for(let d=0;d<a;d++){let p=Qt(r,a,d,u);(Zt(p,e)||en(p,t))&&c++}return c/(a*s)>i}function wt(n,e=500,t=500){let i=n.getContext("2d"),o=i.canvas.width,a=i.canvas.height,s=i.getImageData(0,0,o,a),r=s.width,c=s.height,l=r/c,u=r,d=c;if(u>e&&(u=e,d=Math.floor(u/l)),d>t&&(d=t,u=Math.floor(d*l)),u===r&&d===c)return n;let p=de(r,c);p.getContext("2d").putImageData(s,0,0);let w=de(u,d);return w.getContext("2d").drawImage(p,0,0,r,c,0,0,u,d),w}async function vt(n,e){let t={v:X.runtime.getManifest().version,key:tn(n)};return t.url=await E("tab::getURL",[]),t}function tn(n){return!n.keys||!n.keys.length?n.key:n.keys[Math.floor(Math.random()*n.keys.length)]}function qe(n){return new Promise((e,t)=>{let i=new FileReader;i.onload=()=>e(i.result),i.onerror=()=>t(new Error("filereader")),i.readAsDataURL(n)})}var ze,nn,he,yt,V=class{static blob_to_data_url(e){return new Promise((t,i)=>{let o=new FileReader;o.onload=()=>t(o.result),o.onerror=()=>i(new Error("filereader")),o.readAsDataURL(e)})}static display(...e){return new Promise(async(t,i)=>{let o=[],a=null;for(let r of e)if(a===null&&typeof r=="string"&&/^data:/.test(r))a=r;else if(a===null&&r instanceof Blob)a=await V.blob_to_data_url(r);else if(a===null&&(r instanceof HTMLImageElement||r instanceof HTMLVideoElement))a=r.src;else if(a===null&&r instanceof ImageBitmap){let c=new OffscreenCanvas(r.width,r.height),l=c.getContext("2d");if(!l)return i(new Error("offscreen canvas failed to get 2d context"));l.drawImage(r,0,0);let u=await c.convertToBlob();a=await V.blob_to_data_url(u)}else if(a===null&&r instanceof ImageData){let c=new OffscreenCanvas(r.width,r.height),l=c.getContext("2d");if(!l)return i(new Error("offscreen canvas failed to get 2d context"));l.putImageData(r,0,0);let u=await c.convertToBlob();a=await V.blob_to_data_url(u)}else if(a===null&&r instanceof HTMLCanvasElement)try{a=r.toDataURL()}catch{let l=await new Promise((u,d)=>{r.toBlob(p=>{p?u(p):d(new Error("canvas toBlob failed"))})});a=await V.blob_to_data_url(l)}else if(a===null&&r instanceof OffscreenCanvas){let c=await r.convertToBlob();a=await V.blob_to_data_url(c)}else o.push(r);if(a){let r=a.match(/^data:([^;]+);base64,(.+)$/);if(r){let c=[],l=r[1],u=r[2],d=u.length*3/4-(u.endsWith("==")?2:u.endsWith("=")?1:0);c.push("mime: ".padStart(16)+`${l}
`),c.push("size: ".padStart(16)+`${m(this,he,yt).call(this,d)}
`);let p=0;await new Promise((C,v)=>{let y=new Image;y.onload=()=>{c.push("dim: ".padStart(16)+`${y.naturalWidth}x${y.naturalHeight}
`),p=y.naturalWidth,C(!0)},y.onerror=G=>{v(new Error("image load failed"))},y.src=a});let _=c.reduce((C,v)=>Math.max(C,v.length),0),w=Math.max(0,Math.floor(p/7)-_+p%7-2);for(let C=0;C<c.length;C++)c[C]=`${" ".repeat(w)}${c[C]}`;let f=c.join(""),S=String.fromCharCode(27);o.unshift(S+"[1;33m"+f+S+"[0m")}}o.length===0&&o.push("(image)");for(let r=o.length-1;r>0;r--)typeof o[r]=="string"&&(o[0]=(o[0]||"")+o[r],o.splice(r,1));let s=new Image;if(s.onload=()=>{t(!0)},s.onerror=r=>{i(new Error("image load failed"))},!a)return i(new Error("no image data provided"));s.src=a})}},me=V;ze=new WeakSet,nn=function(e,...t){let i={"font-size":"1px",padding:`${Math.floor(e.height/4)}px ${Math.floor(e.width/2)}px`,"line-height":`${e.height/2}px`,background:`url(${e.src}) no-repeat center`,"background-size":`${e.width}px ${e.height}px`};return[`%c+%c
%s`,Object.keys(i).map(o=>`${o}: ${i[o]}`).join("; "),"",...t]},he=new WeakSet,yt=function(e){let t=["B","KB","MB","GB","TB"],i=e,o=0;for(;i>=1024&&o<t.length-1;)i/=1024,o++;return`${i.toFixed(2)} ${t[o]}`},h(me,ze),h(me,he);var N,be,_e,we,H,ve,xt,ye,xe,M,B,Ee,Et,ke,kt,$,L,A,j,ee,ge,F,Y,te,pe,ae,We,Te,Tt,ne,fe,q,Q,ie,Ge,Ce,Ct,Se,St,Me,Mt,W,Z,T,Be,Bt,Ie,It,je=class{static async detect_media(e,{timeout_ms:t=1500,concurrency:i=4,prefer:o=null,candidates:a=null,return_all:s=!1}={}){if(typeof e!="string"||(e=e.trim()).length===0)throw new Error(`url must be a non-empty string, got: ${e}`);if(typeof t!="number"||!Number.isFinite(t)||Math.floor(t)!==t||t<1)throw new Error(`timeout_ms must be a positive integer, got: ${t}`);if(typeof i!="number"||!Number.isFinite(i)||Math.floor(i)!==i||i<1)throw new Error(`concurrency must be a positive integer, got: ${i}`);if(!["image","video",null].includes(o))throw new Error(`prefer must be 'image', 'video', or null, got: ${o}`);let r=Array.isArray(a)?a.filter(Boolean):null;if(r&&!r.length)throw new Error(`candidates must be a non-empty array of strings or null, got: ${a}`);let c=m(this,Ee,Et).call(this,e);if(c&&!s)return c;let l=m(this,ee,ge).call(this,e);if(l&&g(this,N)[l]){let _=m(this,W,Z).call(this,e,{ext:l,from:"url"});return s||m(this,$,L).call(this,e,_),_}try{let _=await m(this,ie,Ge).call(this,e,t,null);if(m(this,te,pe).call(this,_.status)){let w=_.headers.get("content-type")||"";if(w){let f=m(this,W,Z).call(this,e,{mime:w,from:"head"});return s||m(this,$,L).call(this,e,f),f}}}catch{}let u=m(this,Se,St).call(this,e,o,r),d=await m(this,Me,Mt).call(this,e,u,{timeout_ms:t,concurrency:i,return_all:s});if(d.length){let _=d[0],w=m(this,W,Z).call(this,_.url,{ext:_.ext,mime:_.mime,from:"probe"});if(s){w.all=d.map(f=>({ext:f.ext,url:f.url,mime:f.mime})),m(this,$,L).call(this,e,w);for(let f of d)m(this,$,L).call(this,f.url,m(this,W,Z).call(this,f.url,{ext:f.ext,mime:f.mime,from:"probe"}))}else m(this,$,L).call(this,e,w),m(this,$,L).call(this,_.url,w);return w}let p=m(this,W,Z).call(this,e,{from:"unknown"});return s||m(this,$,L).call(this,e,p),p}static async url_to_data_uri(e,{timeout_ms:t=5e3,max_bytes:i=26214400,allow_canvas_image_fallback:o=!1,prefer:a="video",candidates:s=["webm","mp4"]}={}){if(typeof e!="string"||(e=e.trim()).length===0)return{ok:!1,code:g(this,T).INVALID_INPUT,tried:[]};if(e.startsWith("data:"))return{ok:!0,data_url:e,mime:e.slice(5).split(";")[0]||"",from:"as-is",tried:["as-is"]};let r=m(this,ke,kt).call(this,e);if(r)return r;if(e.startsWith("blob:"))try{let d=await(await m(this,q,Q).call(this,e,{method:"GET",cache:"no-store"},t)).blob();if(d.size>i)return m(this,A,j).call(this,e,{ok:!1,code:g(this,T).TOO_LARGE,tried:["blob"]});let p=await qe(d);return m(this,A,j).call(this,e,{ok:!0,data_url:p,mime:d.type||"",from:"blob",tried:["blob"]})}catch{return m(this,A,j).call(this,e,{ok:!1,code:g(this,T).NETWORK,tried:["blob"]})}let c=[],l=null;try{l=await this.detect_media(e,{timeout_ms:Math.max(500,Math.floor(t*.6)),prefer:a,candidates:s}),l.ok&&l.url&&l.url!==e&&(e=l.url,c.push("detect-media"))}catch{}{let u=await m(this,Be,Bt).call(this,e,{timeout_ms:t,max_bytes:i});if(c.push("content_fetch"+(u.ok?"":`:${u.code}`)),u.ok){let d=u.mime||l?.mime||"";if(m(this,ae,We).call(this,{mime:d,data_url:u.data_url})){let p=m(this,F,Y).call(this,d)||l?.ext||m(this,ee,ge).call(this,e)||"";return m(this,A,j).call(this,e,{ok:!0,data_url:u.data_url,mime:d,ext:p,from:u.from,tried:c})}}}{let d=await E("fetch::asData",[e,{method:"GET",cache:"no-store",redirect:"follow",credentials:"omit"},t]);if(c.push("background_fetch"),d?.ok){let p=d.mime||l?.mime||"";if(m(this,ae,We).call(this,{mime:p,data_url:d.data})){let _=m(this,F,Y).call(this,p)||l?.ext||m(this,ee,ge).call(this,e)||"";return m(this,A,j).call(this,e,{ok:!0,data_url:d.data,mime:p,ext:_,from:"background_fetch",tried:c})}}}if(o&&(l?.type==="image"||a==="image")){let u=await m(this,Ie,It).call(this,e,{timeout_ms:t});if(c.push("canvas_image"+(u.ok?"":`:${u.code}`)),u.ok)return m(this,A,j).call(this,e,{ok:!0,data_url:u.data_url,mime:u.mime||"image/png",ext:m(this,F,Y).call(this,u.mime||"image/png")||"png",from:u.from,tried:c})}return{ok:!1,code:g(this,T).EXHAUSTED,tried:c}}},b=je;N=new WeakMap,be=new WeakMap,_e=new WeakMap,we=new WeakMap,H=new WeakMap,ve=new WeakSet,xt=function(e){try{return new URL(e,typeof window<"u"?window.location.href:"http://localhost").origin}catch{return""}},ye=new WeakMap,xe=new WeakMap,M=new WeakMap,B=new WeakMap,Ee=new WeakSet,Et=function(e){let t=g(this,M).get(e);return t?(g(this,M).delete(e),g(this,M).set(e,t),t):null},ke=new WeakSet,kt=function(e){let t=g(this,B).get(e);return t?(g(this,B).delete(e),g(this,B).set(e,t),t):null},$=new WeakSet,L=function(e,t){return g(this,M).has(e)&&g(this,M).delete(e),g(this,M).set(e,t),g(this,M).size>g(this,ye)&&g(this,M).delete(g(this,M).keys().next().value),t},A=new WeakSet,j=function(e,t){return g(this,B).has(e)&&g(this,B).delete(e),g(this,B).set(e,t),g(this,B).size>g(this,xe)&&g(this,B).delete(g(this,B).keys().next().value),t},ee=new WeakSet,ge=function(e){let t=e.match(/\.([a-z0-9]+)(?:[\?#]|$)/i);return t?t[1].toLowerCase():""},F=new WeakSet,Y=function(e){if(!e)return"";let t=g(this,be).get(e);if(t)return t;if(e.startsWith("image/")){if(e.includes("webp"))return"webp";if(e.includes("avif"))return"avif";if(e.includes("svg"))return"svg";if(e.includes("png"))return"png";if(/jpe?g/.test(e))return"jpg";if(e.includes("gif"))return"gif";if(e.includes("tiff"))return"tiff"}else if(e.startsWith("video/")){if(e.includes("webm"))return"webm";if(e.includes("mp4"))return"mp4";if(e.includes("ogg"))return"ogv";if(e.includes("mpeg"))return"mpeg";if(e.includes("3gpp2"))return"3g2";if(e.includes("3gpp"))return"3gp";if(e.includes("mp2t"))return"ts";if(e.includes("x-msvideo"))return"avi"}else if(e.startsWith("audio/")){if(e.includes("mpeg"))return"mp3";if(e.includes("ogg"))return"oga";if(e.includes("aac"))return"aac";if(e.includes("wav"))return"wav";if(e.includes("webm"))return"weba"}else if(e==="application/pdf")return"pdf";return""},te=new WeakSet,pe=function(e){return e>=200&&e<300},ae=new WeakSet,We=function({mime:e=null,data_url:t=null}={}){if(e&&(e.startsWith("image/")||e.startsWith("video/")||e.startsWith("audio/")))return!0;if(t){let i=t.match(/^data:([^;]+);/);if(i){let o=i[1];return o.startsWith("image/")||o.startsWith("video/")||o.startsWith("audio/")}}return!1},Te=new WeakSet,Tt=function(e,t){if(!t)return!1;let i=m(this,F,Y).call(this,t);if(!e)return!!i;if(i)return i===e;let o=g(this,N)[e];return o?t.startsWith(o.type+"/"):!0},ne=new WeakSet,fe=function(e,t){if(!e)return;if(e.aborted){try{t.abort(e.reason||"upstream")}catch{}return}let i=()=>{try{t.abort(e.reason||"upstream")}catch{}e.removeEventListener("abort",i)};e.addEventListener("abort",i)},q=new WeakSet,Q=async function(e,t,i){let o=null,a=t&&t.signal?t.signal:null;if(typeof AbortSignal<"u"&&AbortSignal.timeout){let s=AbortSignal.timeout(i);return a?(o=new AbortController,m(this,ne,fe).call(this,a,o),m(this,ne,fe).call(this,s,o),a=o.signal):a=s,await fetch(e,{...t,signal:a})}else{o=new AbortController,m(this,ne,fe).call(this,t&&t.signal,o);let s=setTimeout(()=>{try{o.abort("timeout")}catch{}},i);try{let r=await fetch(e,{...t,signal:o.signal});return clearTimeout(s),r}catch(r){throw clearTimeout(s),r}}},ie=new WeakSet,Ge=async function(e,t,i){let o=m(this,ve,xt).call(this,e),a=g(this,H).get(o)||{block_head:!1,cors_opaque:!1},s={redirect:"follow",cache:"no-store"};if(a.block_head)try{let r=await m(this,q,Q).call(this,e,{...s,method:"GET",headers:{range:"bytes=0-0"},signal:i},Math.max(400,Math.floor(t*.9)));return typeof Response<"u"&&r.type==="opaque"&&g(this,H).set(o,{...a,cors_opaque:!0}),r}catch{throw new Error("range-failed")}try{let r=await m(this,q,Q).call(this,e,{...s,method:"HEAD",signal:i},t);return typeof Response<"u"&&r.type==="opaque"&&g(this,H).set(o,{...a,cors_opaque:!0}),r}catch{g(this,H).set(o,{...a,block_head:!0});try{let c=await m(this,q,Q).call(this,e,{...s,method:"GET",headers:{range:"bytes=0-0"},signal:i},Math.max(400,Math.floor(t*.9)));return typeof Response<"u"&&c.type==="opaque"&&g(this,H).set(o,{...a,cors_opaque:!0}),c}catch{throw new Error("range-failed")}}},Ce=new WeakSet,Ct=function(e,t){let i=new URL(e,typeof window<"u"?window.location.href:"http://localhost"),o=i.pathname.split("/"),a=o[o.length-1],s=a.match(/^([^\.]+)(\.[^\/\.]+)?$/);if(s){let r=s[1],c=s[2]?s[2].slice(1).toLowerCase():"";c&&g(this,N)[c]?o[o.length-1]=r+"."+t:o[o.length-1]=a+(a.endsWith(".")?"":".")+t}else o[o.length-1]=(a||"index")+"."+t;return i.pathname=o.join("/"),i.toString()},Se=new WeakSet,St=function(e,t,i){if(i&&i.length)return i.slice();let o=g(this,_e);if(t==="image")return o.slice();let a=g(this,we);return t==="video"?a.slice():e.includes("/tip/")||e.includes("hcaptcha")?["webm","mp4"]:[...o,...a]},Me=new WeakSet,Mt=async function(e,t,{timeout_ms:i,concurrency:o,return_all:a}){let s=[],r=0,c=0,l=Number.POSITIVE_INFINITY,u=!1,d=null,p=()=>{a||u||Number.isFinite(l)&&(u=!0,d(!0))},_=async f=>{c+=1;let S=t[f],C=m(this,Ce,Ct).call(this,e,S);try{let v=await m(this,ie,Ge).call(this,C,i,null);if(typeof Response<"u"&&v&&v.type==="opaque")return;if(v&&m(this,te,pe).call(this,v.status)){let y=v.headers.get("content-type")||"";m(this,Te,Tt).call(this,S,y)&&(s.push({index:f,url:C,ext:S,mime:y}),!a&&f<l&&(l=f,p()))}}catch{}c-=1},w=async()=>{for(;r<t.length&&c<o;)_(r),r+=1;return a?c===0&&r>=t.length?!0:(await new Promise(f=>setTimeout(f,0)),await w()):Number.isFinite(l)||c===0&&r>=t.length?!0:(await new Promise(f=>setTimeout(f,0)),await w())};return a?await w():await Promise.race([new Promise(f=>{d=f}),w()]),s.sort((f,S)=>f.index-S.index),s},W=new WeakSet,Z=function(e,{ext:t="",mime:i="",from:o="unknown"}={}){let a=t||m(this,F,Y).call(this,i)||"",s=a?g(this,N)[a]:null;return{ok:!!(a||i),url:e,ext:a,mime:i||(s?s.mime:""),type:s?s.type:i?i.split("/")[0]:"",kind:s?s.kind:"",from:o,all:void 0}},T=new WeakMap,Be=new WeakSet,Bt=async function(e,{timeout_ms:t,max_bytes:i}){try{let o=await m(this,q,Q).call(this,e,{method:"GET",cache:"no-store",redirect:"follow",credentials:"omit"},t);if(typeof Response<"u"&&o.type==="opaque")return{ok:!1,code:g(this,T).OPAQUE};if(!m(this,te,pe).call(this,o.status))return{ok:!1,code:g(this,T).NETWORK,status:o.status};let a=o.headers.get("content-length");if(a&&Number.isFinite(+a)&&+a>i)return{ok:!1,code:g(this,T).TOO_LARGE,size:+a};let s=await o.blob();if(s.size>i)return{ok:!1,code:g(this,T).TOO_LARGE,size:s.size};let r=await qe(s),c=s.type||"";return{ok:!0,data_url:r,mime:c,from:"content_fetch"}}catch(o){return o&&(o.name==="TimeoutError"||o==="timeout")||(o?.message||"").includes("timeout")?{ok:!1,code:g(this,T).TIMEOUT}:{ok:!1,code:g(this,T).NETWORK}}},Ie=new WeakSet,It=async function(e,{timeout_ms:t,target_mime:i="image/png",quality:o=.92}){let a=new Image;a.crossOrigin="anonymous";let s=setTimeout(()=>{try{a.src=""}catch{}},t);try{await new Promise((p,_)=>{a.onload=()=>p(!0),a.onerror=()=>_(new Error("img-error")),a.src=e}),clearTimeout(s);let r=Math.max(1,a.naturalWidth||a.width||1),c=Math.max(1,a.naturalHeight||a.height||1),l=typeof OffscreenCanvas<"u"?new OffscreenCanvas(r,c):(()=>{let p=document.createElement("canvas");return p.width=r,p.height=c,p})(),u=l.getContext("2d",{alpha:!0});if(!u)return{ok:!1,code:g(this,T).UNSUPPORTED};u.drawImage(a,0,0,r,c);let d;try{d=l.convertToBlob?await(async()=>{let p=await l.convertToBlob({type:i,quality:o});return await qe(p)})():l.toDataURL(i,o)}catch{return{ok:!1,code:g(this,T).CORS_TAINTED}}return{ok:!0,data_url:d,mime:i,from:"canvas_image"}}catch(r){return clearTimeout(s),r&&(r.name==="TimeoutError"||r==="timeout")?{ok:!1,code:g(this,T).TIMEOUT}:{ok:!1,code:g(this,T).NETWORK}}},h(b,ve),h(b,Ee),h(b,ke),h(b,$),h(b,A),h(b,ee),h(b,F),h(b,te),h(b,ae),h(b,Te),h(b,ne),h(b,q),h(b,ie),h(b,Ce),h(b,Se),h(b,Me),h(b,W),h(b,Be),h(b,Ie),h(b,N,{apng:{type:"image",mime:"image/apng",kind:"Animated Portable Network Graphics (APNG) image"},avif:{type:"image",mime:"image/avif",kind:"AVIF image"},bmp:{type:"image",mime:"image/bmp",kind:"Windows OS/2 Bitmap Graphics"},gif:{type:"image",mime:"image/gif",kind:"Graphics Interchange Format (GIF)"},ico:{type:"image",mime:"image/vnd.microsoft.icon",kind:"Icon format"},jpeg:{type:"image",mime:"image/jpeg",kind:"JPEG images"},jpg:{type:"image",mime:"image/jpeg",kind:"JPEG images"},png:{type:"image",mime:"image/png",kind:"Portable Network Graphics"},svg:{type:"image",mime:"image/svg+xml",kind:"Scalable Vector Graphics (SVG)"},tif:{type:"image",mime:"image/tiff",kind:"Tagged Image File Format (TIFF)"},tiff:{type:"image",mime:"image/tiff",kind:"Tagged Image File Format (TIFF)"},webp:{type:"image",mime:"image/webp",kind:"WEBP image"},"3g2":{type:"video",mime:"video/3gpp2",kind:"3GPP2 audio/video container"},"3gp":{type:"video",mime:"video/3gpp",kind:"3GPP audio/video container"},avi:{type:"video",mime:"video/x-msvideo",kind:"AVI: Audio Video Interleave"},mp4:{type:"video",mime:"video/mp4",kind:"MP4 video"},mpeg:{type:"video",mime:"video/mpeg",kind:"MPEG Video"},ogv:{type:"video",mime:"video/ogg",kind:"Ogg video"},ts:{type:"video",mime:"video/mp2t",kind:"MPEG transport stream"},webm:{type:"video",mime:"video/webm",kind:"WEBM video"}}),h(b,be,(()=>{let e=new Map;for(let[t,i]of Object.entries(g(je,N)))e.set(i.mime,t);return e})()),h(b,_e,["webp","avif","jpeg","jpg","png","gif","apng","bmp","svg"]),h(b,we,["webm","mp4","ogv","mpeg","3gp","3g2","ts","avi"]),h(b,H,new Map),h(b,ye,512),h(b,xe,64),h(b,M,new Map),h(b,B,new Map),h(b,T,Object.freeze({INVALID_INPUT:"invalid-input",TIMEOUT:"timeout",TOO_LARGE:"too-large",NETWORK:"network",OPAQUE:"opaque",CORS_TAINTED:"cors-tainted",UNSUPPORTED:"unsupported",EXHAUSTED:"exhausted"}));var Ve,Pe=!1;function $t(){return!!document.querySelector(".lemin-captcha-popup")}function Ot(){Pe=!0,Ve=new MutationObserver(n=>{n[0].addedNodes.length>0&&Rt()}),Ve.observe(document.querySelector(".lemin-captcha-popup"),{childList:!0}),document.querySelector(".lemin-captcha-popup")&&Rt()}function At(){Ve.disconnect(),Pe=!1}function Dt(){return Pe}var Pt=!1;async function Rt(){if(Pt)return;Pt=!0;let n;for(;Pe;){let e=le(),t=Date.now().valueOf(),i=document.querySelector("#lemin-captcha-caption")?.textContent;if(!i){n=void 0,await k(1e3);continue}let o=512,a=document.querySelector(".lemin-captcha-popup").querySelectorAll('img[name*="image"]')?.[0],s=await on(o,a);if(!s){n=void 0,await k(1e3);continue}let r=new Image;r.src=`data:image/png;base64,${s}`,await new Promise(R=>r.onload=R);let c=document.createElement("canvas"),l=Math.min(r.width,r.height);c.width=l,c.height=l,c.getContext("2d").drawImage(r,0,0,l,l,0,0,l,l);let d=c.toDataURL("image/png"),p=`${i}:${s}`;if(p===n){await k(1e3);continue}n=p;let _=await E("api::recognition",[{type:"lemincaptcha",task:i,image_data:[d],...await vt(e)}]);if(!_||"error"in _){document.querySelector(".lemincaptcha_refresh")?.click(),await k(3e3);continue}let w=new Date().valueOf();if(e.lemincaptcha_solve_delay){let R=e.lemincaptcha_solve_delay_time-w+t;R>0&&await k(R)}let f=_.data;if(!f){document.querySelector(".lemincaptcha_refresh")?.click(),await k(3e3);continue}let S=document.querySelector(".captcha-body"),v=document.querySelectorAll('img[name*="image"]')?.[1]?.parentElement,y=a.parentElement,G=document.querySelector(".piece-area");if(!S||!v||!y||!G){document.querySelector(".lemincaptcha_refresh")?.click(),await k(3e3);continue}let I=S.getBoundingClientRect(),z=v.getBoundingClientRect(),P=y.getBoundingClientRect(),J=G.getBoundingClientRect(),U=z.left-I.left+z.width/2,O=z.top-I.top+z.height/2,Lt=parseFloat(f.x)/100*P.width,Nt=parseFloat(f.y)/100*P.height,re=U+window.scrollX+I.left,se=O+window.scrollY+I.top,Re=Lt+window.scrollX+I.left,$e=Nt+window.scrollY+I.top;oe(v,"pointerdown",re,se,1),oe(v,"mousedown",re,se,1),await k(200);let Je=16;for(let R=1;R<=Je;R++){let ce=R/Je,Oe=re+(Re-re)*ce,Ue=se+($e-se)*ce;oe(v,"pointermove",Oe,Ue,1),oe(v,"mousemove",Oe,Ue,1),await k(10)}await k(200),oe(v,"mouseup",Re,$e,0),oe(v,"pointerup",Re,$e,0),await k(5e3),document.querySelector(".verify-button")?.click()}}function oe(n,e,t,i,o=0){let a={bubbles:!0,cancelable:!0,clientX:t,clientY:i,buttons:o},s=e.startsWith("pointer")?new PointerEvent(e,{...a,pointerId:1,pointerType:"mouse"}):new MouseEvent(e,a);n.dispatchEvent(s)}async function on(n,e){let t=await ht(e);if(t&&(bt(t,"[@nope/lemincaptcha]",`${t.width}x${t.height}`),!_t(t)))return n!==null&&(t=wt(t,n,n)),ft(t)}async function an(){rt(),await tt(),await E("tab::registerDetectedCaptcha",["lemincaptcha"]);let e=new URLSearchParams(location.hash.substring(1)).get("host");Ae({name:"lemincaptcha/auto-open",condition:t=>t.enabled&&t.lemincaptcha_auto_open&&!t.disabled_hosts.includes(e),ready:dt,start:mt,quit:gt,running:pt}),Ae({name:"lemincaptcha/auto-solve",condition:t=>t.enabled&&t.lemincaptcha_auto_solve&&!t.disabled_hosts.includes(e),ready:$t,start:Ot,quit:At,running:Dt})}De(an);})();
