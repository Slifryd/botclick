(()=>{function N(){if("ancestorOrigins"in location){let t=location.ancestorOrigins,n=t[1]??t[0];if(n)return n.split("/")[2]}let e=document.referrer;return e?e.split("/")[2]:location.origin}var v=chrome;var Me="https://api.nopecha.com";var d="https://www.nopecha.com",U="https://developers.nopecha.com",Se="https://nopecha.com/api-reference/",Ke={doc:{url:U,automation:{url:`${U}/guides/extension_advanced/#automation-build`}},ref:{url:Se},api:{base:Me,recognition:"/v1/recognition",status:"/v1/status"},www:{url:d,annoucement:{url:`${d}/json/announcement.json`},demo:{url:`${d}/captcha`,hcaptcha:{url:`${d}/captcha/hcaptcha`},recaptcha:{url:`${d}/captcha/recaptcha`},funcaptcha:{url:`${d}/captcha/funcaptcha`},awscaptcha:{url:`${d}/captcha/awscaptcha`},textcaptcha:{url:`${d}/captcha/textcaptcha`},turnstile:{url:`${d}/captcha/turnstile`},perimeterx:{url:`${d}/captcha/perimeterx`},geetest:{url:`${d}/captcha/geetest`},lemincaptcha:{url:`${d}/captcha/lemincaptcha`}},manage:{url:`${d}/manage`},pricing:{url:`${d}/pricing`},setup:{url:`${d}/setup`}},discord:{url:`${d}/discord`},github:{url:`${d}/github`,release:{url:`${d}/github/release`}}};function W(e){let t=("4bba7932fc09d4cce09e1aba0037cb66b9c0d39d70f4cb482262ba1f523717a7"+e).split("").map(n=>n.charCodeAt(0));return J(t)}var z=new Uint32Array(256);for(let e=256;e--;){let t=e;for(let n=8;n--;)t=t&1?3988292384^t>>>1:t>>>1;z[e]=t}function J(e){let t=-1;for(let n of e)t=t>>>8^z[t&255^n];return(t^-1)>>>0}async function g(e,t){let n=""+[+new Date,performance.now(),Math.random()],[o,r]=await new Promise(a=>{v.runtime.sendMessage([n,e,...t],i=>{a(i)})});if(o===W(n))return r}function S(){let e;return t=>e||(e=t().finally(()=>e=void 0),e)}var b,Ie=S();function j(){return Ie(async()=>(b||(b=await g("settings::get",[])),b))}function V(e){b&&(b={...b,...e},G(b))}function I(){return b}function c(e){return new Promise(t=>setTimeout(t,e))}var Q=[];function R(e,t){e.timedout=!1,Q.push(e);let n,o=setInterval(async()=>{await K(e,I())||(clearTimeout(n),clearInterval(o))},400);t&&(n=setTimeout(()=>clearInterval(o),t),e.timedout=!0)}async function K(e,t){if(e.timedout)return!1;let n=e.condition(t);if(n===e.running())return!1;if(!n&&e.running())return e.quit(),!1;if(n&&!e.running()){for(;!e.ready();)await c(200);return e.start(),!1}}function G(e){Q.forEach(t=>K(t,e))}function Z(){v.runtime.connect({name:"stream"}).onMessage.addListener(t=>{t.event==="settingsUpdate"&&V(t.settings)})}function P(e){if(document.readyState!=="loading")setTimeout(e,0);else{let t;t=()=>{removeEventListener("DOMContentLoaded",t),e()},addEventListener("DOMContentLoaded",t)}}var ht=S();function Ee(){return!0}async function ke(e){e.scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"}),await new Promise(t=>requestAnimationFrame(t))}function Y(){let e=`verify_${Math.random().toString(36).slice(2)}`;return document.documentElement.setAttribute("data-frame-token",e),e}function ee(){document.documentElement.removeAttribute("data-frame-token")}var y=null,X=null;async function Te(){if(y!==null)return y;clearTimeout(X),X=setTimeout(()=>{y=null},6e4),y=!1,await g("debugger::enable",[]);let e=Y();try{await g("debugger::mouseCapable",[e])===!0&&(y=!0)}catch{}finally{ee()}return y}async function E(e,t,n,o,r,a){await g("debugger::enable",[]);let i=Y();try{if(await g("debugger::mouse",[i,e,t,n,o,r,a])===!0)return!0}catch{}finally{ee()}return!1}async function L(e,t,n,o,r,a,i){await g("debugger::enable",[]),await ke(e);let s=e.getBoundingClientRect();if(s.width===0||s.height===0)return!1;n=n??null,o=o??null;let l=n!==null?s.left+n:s.left+s.width/2,u=o!==null?s.top+o:s.top+s.height/2,m=4;if(n===null){let f=Math.floor((Math.random()-.5)*.5*Math.max(s.width-m*2,0));l+=f}if(o===null){let f=Math.floor((Math.random()-.5)*.5*Math.max(s.height-m*2,0));u+=f}return await E(t,l,u,r,a,i)}async function Be(e,t,n,o,r,a){if(["focus","blur","click","pointerdown","pointerup","pointermove","pointerrawupdate","pointerover","pointerenter","mouseenter","mouseover","pointerout","pointerleave","mouseout","mouseleave"].includes(t))return!0;r=r??0;let l=["none","left","middle","right"][r]??"none";return t==="mousedown"?e===null?await E("mousePressed",n,o,l,1,a):await L(e,"mousePressed",n,o,l,1,a):t==="mouseup"?(l=l==="none"?"left":l,e===null?await E("mouseReleased",n,o,l,1,a):await L(e,"mouseReleased",n,o,l,1,a)):t==="mousemove"?e===null?await E("mouseMoved",n,o,l,0,a):await L(e,"mouseMoved",n,o,l,0,a):!1}function Re(e,t,n,o,r){e===null&&(e=document.body),r=r??0,["pointerup","mouseup"].includes(t)&&r!==0&&(r=0);let a=null;if(t==="focus"){let i={bubbles:!1,cancelable:!1,view:window};a=new FocusEvent(t,i)}else if(t==="blur"){let i={bubbles:!1,cancelable:!1,view:window};a=new FocusEvent(t,i)}else if(t==="click"){let i={bubbles:!0,cancelable:!0,view:window,buttons:0,clientX:Math.floor(n),clientY:Math.floor(o),pointerId:1,pointerType:"mouse"};a=new PointerEvent(t,i)}else if(t.startsWith("mouse")){let i={bubbles:!0,cancelable:!0,view:window,buttons:r,clientX:Math.floor(n),clientY:Math.floor(o)};a=new MouseEvent(t,i)}else if(t.startsWith("pointer")){t==="pointerrawupdate"&&(n+=87.857,o+=10.571);let i={bubbles:!0,cancelable:!0,view:window,buttons:r,clientX:n+.2857360839844,clientY:o+.42857360839844,pointerId:1,pointerType:"mouse"};a=new PointerEvent(t,i)}else return!1;try{return e.dispatchEvent(a),!0}catch{return!1}}function Pe(e){let t=typeof e=="string"?document.querySelector(e):e;return t||null}async function Le(){return!!(Ee()&&await Te()===!0)}async function $e(e,t,n,o,r,a,i){return i=i??await Le(),!!(i&&await Be(e,t,n,o,r,a)||Re(e,t,n,o,r)===!0)}async function C(e,t,n){t=t??null,n=n??null;let o=t,r=n,a=null;if(e===null){if(t===null||n===null)return!1}else{if(a=Pe(e),a===null)return!1;let l=a.getBoundingClientRect();o=t??l.width/2,r=n??l.height/2;let u=4;if(t===null){let m=Math.floor((Math.random()-.5)*.5*Math.max(l.width-u*2,0));o+=m}if(n===null){let m=Math.floor((Math.random()-.5)*.5*Math.max(l.height-u*2,0));r+=m}}let i=[{name:"pointerrawupdate",buttons:0,delayMs:0},{name:"pointerover",buttons:0,delayMs:0},{name:"pointerenter",buttons:0,delayMs:0},{name:"mouseover",buttons:0,delayMs:0},{name:"mouseenter",buttons:0,delayMs:10},{name:"pointermove",buttons:0,delayMs:0},{name:"mousemove",buttons:0,delayMs:10},{name:"pointerrawupdate",buttons:0,delayMs:0},{name:"pointermove",buttons:0,delayMs:0},{name:"mousemove",buttons:0,delayMs:30},{name:"focus",buttons:0,delayMs:0},{name:"pointerdown",buttons:1,delayMs:0},{name:"mousedown",buttons:1,delayMs:30},{name:"pointerup",buttons:0,delayMs:0},{name:"mouseup",buttons:0,delayMs:0},{name:"click",buttons:0,delayMs:0}],s=[];for(let{name:l,buttons:u,delayMs:m}of i){let f=await $e(a,l,o,r,u);s.push(f),m&&await c(m)}return s.every(l=>l)}var D,H,A=!1;function ne(){return!!document.querySelector(".recaptcha-checkbox")}function oe(){A=!0,D=new MutationObserver(t=>{t.length===2&&te(),t.length&&t[0].target.classList.contains("recaptcha-checkbox-expired")&&window.location.reload()}),D.observe(document.querySelector(".recaptcha-checkbox"),{attributes:!0});let e=!1;H=new IntersectionObserver(()=>{e||(e=!0,te())},{threshold:0}),H.observe(document.body)}function ae(){D.disconnect(),H.disconnect(),A=!1}function re(){return A}var $=!1;async function te(){if(!$){$=!0;try{await c(500),await C(".recaptcha-checkbox")}catch{}finally{$=!1}}}function ie(){return[]}function le(e,t){return new Promise((n,o)=>{e.push(n),t&&setTimeout(()=>{o(new Error("Signal wait timeout"))},t)})}function k(e){e.forEach(t=>t()),e.splice(0)}async function se(e,t){let n={v:v.runtime.getManifest().version,key:De(e)};return n.url=await g("tab::getURL",[]),n}function De(e){return!e.keys||!e.keys.length?e.key:e.keys[Math.floor(Math.random()*e.keys.length)]}function He(e,t){let n=document.createElement("canvas");return n.width=e,n.height=t,n}function ce(e){return e.toDataURL("image/jpeg").replace(/data:image\/[a-z]+;base64,/g,"")}function Ae(e){try{e.getContext("2d").getImageData(0,0,1,1)}catch{return!0}return!1}async function ue(e,t,n=1e4){if(!t&&!e.complete&&!await new Promise(i=>{let s=setTimeout(()=>{i(!1)},n);e.addEventListener("load",()=>{clearTimeout(s),i(!0)})}))return;let o=He(e.naturalWidth||t?.clientWidth,e.naturalHeight||t?.clientHeight);return o.getContext("2d").drawImage(e,0,0),!Ae(o)&&o}function qe(e,t,n,o){let r=(o*t+n)*4;return[e[r],e[r+1],e[r+2]]}function Oe(e,t){return e.every(n=>n<=t)}function Fe(e,t){return e.every(n=>n>=t)}function de(e,t=0,n=230,o=.99){let r=e.getContext("2d"),a=r.canvas.width,i=r.canvas.height;if(a===0||i===0)return!0;let s=r.getImageData(0,0,a,i).data,l=0;for(let m=0;m<i;m++)for(let f=0;f<a;f++){let h=qe(s,a,f,m);(Oe(h,t)||Fe(h,n))&&l++}return l/(a*i)>o}var Ne={[1]:1,[0]:3,[2]:4},T=ie(),O,_=!1;function fe(){return!!document.querySelector(".rc-imageselect, .rc-imageselect-target")}function be(){_=!0,k(T);let e=null;O=new MutationObserver(()=>{clearTimeout(e),e=setTimeout(()=>k(T),1e3)}),O.observe(document.body,{childList:!0,subtree:!0}),je()}function he(){O.disconnect(),_=!1,k(T)}function _e(){return _}function Ue(){return document.querySelector(".rc-doscaptcha-header")}function We(){return!!document.querySelector('[aria-live="polite"] > [tabindex], [class^="rc-imageselect-error-"][tabindex]')}function me(){return!!document.querySelector("#recaptcha-verify-button[disabled]")}async function ge(){await C("#recaptcha-verify-button")}async function q(){await C("#recaptcha-reload-button, .rc-button-reload, .reload-button-holder button")}async function ze(e=3e4){let t=Date.now()+e;for(;Date.now()<t&&_;){await c(1e3);let n=document.querySelector(".rc-imageselect-instructions");if(n===null)continue;let o=n.innerText.split(`
`),r=o.slice(0,2).join(" ").replace(/\s+/g," ").trim(),a=[...document.querySelectorAll("table tr td")];if(a.length!==9&&a.length!==16)continue;let i=a.map(u=>u.querySelector("img")).filter(u=>u).filter(u=>u.src.trim());if(i.length!==9&&i.length!==16)continue;let s=a.length===16?2:i.some(u=>u.classList.contains("rc-image-tile-11"))?1:0,l=o.length===3&&s!==2;return{task:r,type:s,cells:a,images:i,waitAfterSolve:l}}return null}async function Je(e=3e4){let t=Date.now()+e;for(;Date.now()<t&&_;){if(document.querySelectorAll(".rc-imageselect-dynamic-selected").length===0)return!0;await c(1e3)}return!1}var pe=!1;async function je(){if(!pe){for(pe=!0;_&&(Ue()||me());)await c(1e3);for(;_;){let e=await ze();if(e===null){await c(1e3),await q(),await c(1e3);continue}let{task:t,type:n,cells:o,images:r,waitAfterSolve:a}=e,i=Date.now(),s=[...o];n!==1&&(r=[r[0]]);let l=await Promise.all(r.map(p=>ue(p)));if(n===1){let p=[],x=[];for(let[B,w]of l.entries())w.width!==100||w.height!==100||(p.push(s[B]),x.push(w));s=p,l=x}if(l.length===0){await ge(),await c(3e3);continue}let u=!1;for(let p of l)if(de(p)){u=!0;break}if(u){await c(3e3);continue}let m=Ne[n],f=`${m}x${m}`,h=I(),we=await se(h),M=await g("api::recognition",[{...we,type:"recaptcha",task:t,image_data:l.map(ce),grid:f}]);if(!M||"error"in M){await c(2e3);continue}let ve=Date.now();if(h.recaptcha_solve_delay&&h.recaptcha_solve_delay_time>0){let p=h.recaptcha_solve_delay_time-ve+i;p>0&&await c(p)}let F=n===2?4:3;for(let[p,x]of s.entries()){let B=x.classList.contains("rc-imageselect-tileselected"),w=o.indexOf(x);if(M.data[p]!==B){let ye=Math.floor(w/F)+1,Ce=w%F+1,xe=`tr:nth-child(${ye}) td:nth-child(${Ce})`;await C(xe)}}(!a||!M.data.some(p=>p))&&(await c(200),await ge());try{await le(T,1e4)}catch{if(me())continue}if(We()){await c(1e3),await q(),await c(1e3);continue}if(!await Je(15e3)){await q(),await c(1e3);continue}}}}async function Ve(){Z(),await j(),await g("tab::registerDetectedCaptcha",["recaptcha"]);let e=N();location.pathname.endsWith("/anchor")?R({name:"recaptcha/auto-open",condition:t=>t.enabled&&t.recaptcha_auto_open&&!t.disabled_hosts.includes(e),ready:ne,start:oe,quit:ae,running:re}):R({name:"recaptcha/auto-solve",condition:t=>t.enabled&&t.recaptcha_auto_solve&&!t.disabled_hosts.includes(e),ready:fe,start:be,quit:he,running:_e})}P(Ve);})();
