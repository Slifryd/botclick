(()=>{var f=chrome;var Q="https://api.nopecha.com";var i="https://www.nopecha.com",k="https://developers.nopecha.com",G="https://nopecha.com/api-reference/",re={doc:{url:k,automation:{url:`${k}/guides/extension_advanced/#automation-build`}},ref:{url:G},api:{base:Q,recognition:"/v1/recognition",status:"/v1/status"},www:{url:i,annoucement:{url:`${i}/json/announcement.json`},demo:{url:`${i}/captcha`,hcaptcha:{url:`${i}/captcha/hcaptcha`},recaptcha:{url:`${i}/captcha/recaptcha`},funcaptcha:{url:`${i}/captcha/funcaptcha`},awscaptcha:{url:`${i}/captcha/awscaptcha`},textcaptcha:{url:`${i}/captcha/textcaptcha`},turnstile:{url:`${i}/captcha/turnstile`},perimeterx:{url:`${i}/captcha/perimeterx`},geetest:{url:`${i}/captcha/geetest`},lemincaptcha:{url:`${i}/captcha/lemincaptcha`}},manage:{url:`${i}/manage`},pricing:{url:`${i}/pricing`},setup:{url:`${i}/setup`}},discord:{url:`${i}/discord`},github:{url:`${i}/github`,release:{url:`${i}/github/release`}}};function B(e){let t=("4bba7932fc09d4cce09e1aba0037cb66b9c0d39d70f4cb482262ba1f523717a7"+e).split("").map(n=>n.charCodeAt(0));return M(t)}var T=new Uint32Array(256);for(let e=256;e--;){let t=e;for(let n=8;n--;)t=t&1?3988292384^t>>>1:t>>>1;T[e]=t}function M(e){let t=-1;for(let n of e)t=t>>>8^T[t&255^n];return(t^-1)>>>0}async function g(e,t){let n=""+[+new Date,performance.now(),Math.random()],[a,o]=await new Promise(c=>{f.runtime.sendMessage([n,e,...t],s=>{c(s)})});if(a===B(n))return o}function I(){let e;return t=>e||(e=t().finally(()=>e=void 0),e)}var p,J=I();function E(){return J(async()=>(p||(p=await g("settings::get",[])),p))}function H(e){p&&(p={...p,...e},$(p))}function h(){return p}function r(e){return new Promise(t=>setTimeout(t,e))}var L=[];function P(e,t){e.timedout=!1,L.push(e);let n,a=setInterval(async()=>{await R(e,h())||(clearTimeout(n),clearInterval(a))},400);t&&(n=setTimeout(()=>clearInterval(a),t),e.timedout=!0)}async function R(e,t){if(e.timedout)return!1;let n=e.condition(t);if(n===e.running())return!1;if(!n&&e.running())return e.quit(),!1;if(n&&!e.running()){for(;!e.ready();)await r(200);return e.start(),!1}}function $(e){L.forEach(t=>R(t,e))}function D(){f.runtime.connect({name:"stream"}).onMessage.addListener(t=>{t.event==="settingsUpdate"&&H(t.settings)})}function C(e){if(document.readyState!=="loading")setTimeout(e,0);else{let t;t=()=>{removeEventListener("DOMContentLoaded",t),e()},addEventListener("DOMContentLoaded",t)}}function X(e,t){let n=document.createElement("canvas");return n.width=e,n.height=t,n}function A(e){return e.toDataURL("image/jpeg").replace(/data:image\/[a-z]+;base64,/g,"")}function Y(e){try{e.getContext("2d").getImageData(0,0,1,1)}catch{return!0}return!1}async function b(e,t,n=1e4){if(!t&&!e.complete&&!await new Promise(s=>{let u=setTimeout(()=>{s(!1)},n);e.addEventListener("load",()=>{clearTimeout(u),s(!0)})}))return;let a=X(e.naturalWidth||t?.clientWidth,e.naturalHeight||t?.clientHeight);return a.getContext("2d").drawImage(e,0,0),!Y(a)&&a}async function q(e){let n=getComputedStyle(e).backgroundImage;if(!n||n==="none")if("src"in e&&e.src)n=`url("${e.src}")`;else return;if("computedStyleMap"in e&&!/url\(["']https?:\/\//.test(n)){let l=e.computedStyleMap().get("background-image");if(l instanceof CSSImageValue){let d=await b(l,e);if(d)return d}}let a=/"(.+)"/.exec(n);if(!a)return;n=a[1];let o=document.createElement("a");if(o.href=n,new URL(o.href).origin===document.location.origin){let l=new Image;l.crossOrigin="anonymous",l.src=n;let d=await b(l);if(d)return d}let c=await g("fetch::asData",[n,{}]),s=new Image;s.crossOrigin="anonymous",s.src=c.data;let u=await b(s);if(u)return u}function Z(e,t,n,a){let o=(a*t+n)*4;return[e[o],e[o+1],e[o+2]]}function ee(e,t){return e.every(n=>n<=t)}function te(e,t){return e.every(n=>n>=t)}function U(e,t=0,n=230,a=.99){let o=e.getContext("2d"),c=o.canvas.width,s=o.canvas.height;if(c===0||s===0)return!0;let u=o.getImageData(0,0,c,s).data,l=0;for(let m=0;m<s;m++)for(let x=0;x<c;x++){let S=Z(u,c,x,m);(ee(S,t)||te(S,n))&&l++}return l/(c*s)>a}function N(){return[]}function O(e,t){return new Promise((n,a)=>{e.push(n),t&&setTimeout(()=>{a(new Error("Signal wait timeout"))},t)})}function v(e){e.forEach(t=>t()),e.splice(0)}async function W(e,t){let n={v:f.runtime.getManifest().version,key:ne(e)};return n.url=await g("tab::getURL",[]),n}function ne(e){return!e.keys||!e.keys.length?e.key:e.keys[Math.floor(Math.random()*e.keys.length)]}var w=N(),y,_=!1;function F(){let e=h(),t=document.querySelector(e.textcaptcha_image_selector),n=document.querySelector(e.textcaptcha_input_selector);return!t||!n?!1:(g("tab::registerDetectedCaptcha",["textcaptcha"]),!0)}function j(){_=!0,v(w),y=new MutationObserver(()=>{setTimeout(()=>v(w),200)}),y.observe(document.body,{subtree:!0,childList:!0,attributes:!0}),oe()}function V(){y.disconnect(),_=!1,v(w)}function K(){return _}async function ae(e){if(e instanceof HTMLCanvasElement)return e;if(e instanceof HTMLImageElement&&(e.src||e.srcset)){let t=await b(e);if(t)return t}return await q(e)}var z=!1;async function oe(){if(z)return;z=!0;let e;for(;_;){let t=h(),n=document.querySelector(t.textcaptcha_image_selector),a=document.querySelector(t.textcaptcha_input_selector);if(!n){await r(500);continue}if(!a){await r(500);continue}if(a.click(),a.focus(),await r(200),a.value!==""){await r(500);continue}let o=await ae(n);if(!o){await r(500);continue}if(U(o)){await r(500);continue}let c=A(o);if(e===c){await r(500);continue}e=c;let s=new Date().valueOf(),u=await g("api::recognition",[{type:"textcaptcha",image_data:[c],...await W(t)}]);if(!u||"error"in u){await r(2e3);continue}let l=new Date().valueOf();if(t.textcaptcha_solve_delay){let d=t.textcaptcha_solve_delay_time-l+s;d>0&&await r(d)}if(u.data&&u.data.length>0&&!a.value){a.click(),a.focus(),await r(200),Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(a,u.data[0]);for(let m of u.data[0])a.dispatchEvent(new KeyboardEvent("keydown",{key:m,bubbles:!0})),await r(15),a.dispatchEvent(new KeyboardEvent("keypress",{key:m,bubbles:!0})),await r(10),a.dispatchEvent(new KeyboardEvent("keyup",{key:m,bubbles:!0})),await r(15);a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0}))}await O(w)}}async function ie(){D(),await E(),await g("tab::registerDetectedCaptcha",["textcaptcha"]);let e=location.hostname;P({name:"textcaptcha/auto-solve",condition:t=>t.enabled&&t.textcaptcha_auto_solve&&!t.disabled_hosts.includes(e)&&!!t.textcaptcha_image_selector&&!!t.textcaptcha_input_selector,ready:F,start:j,quit:V,running:K})}C(ie);})();
